package fr.acinq.lightning.serialization

import fr.acinq.bitcoin.ByteVector
import fr.acinq.bitcoin.Transaction
import fr.acinq.bitcoin.byteVector
import fr.acinq.lightning.CltvExpiryDelta
import fr.acinq.lightning.Feature
import fr.acinq.lightning.Lightning
import fr.acinq.lightning.blockchain.BITCOIN_FUNDING_DEPTHOK
import fr.acinq.lightning.blockchain.WatchEventConfirmed
import fr.acinq.lightning.channel.*
import fr.acinq.lightning.channel.TestsHelper.processEx
import fr.acinq.lightning.channel.states.WaitForFundingConfirmedTestsCommon
import fr.acinq.lightning.serialization.Encryption.from
import fr.acinq.lightning.tests.TestConstants
import fr.acinq.lightning.utils.UUID
import fr.acinq.lightning.utils.msat
import fr.acinq.lightning.wire.ChannelReady
import fr.acinq.lightning.wire.EncryptedChannelData
import fr.acinq.lightning.wire.UpdateAddHtlc
import kotlin.test.*

class CompatibilityTestsCommon {
    @Ignore
    @Test
    fun `generate data`() {
        // generate test data
        val (alice, bob, fundingTx) = run {
            val (alice0, bob0, txSigsBob) = WaitForFundingConfirmedTestsCommon.init(ChannelType.SupportedChannelType.AnchorOutputs)
            val (alice1, actions1) = alice0.processEx(ChannelCommand.MessageReceived(txSigsBob), minVersion = 3)
            assertIs<LNChannel<WaitForFundingConfirmed>>(alice1)
            val fundingTx = actions1.find<ChannelAction.Blockchain.PublishTx>().tx
            Triple(alice1, bob0, fundingTx)
        }
        println("funding_tx: ${Transaction.write(fundingTx).byteVector().toHex()}")
        val bin = EncryptedChannelData.from(TestConstants.Bob.nodeParams.nodePrivateKey, bob.ctx, bob.state)
        println("wait_for_funding_confirmed: ${bin.data}")

        val (bob1, actionsBob) = bob.processEx(ChannelCommand.WatchReceived(WatchEventConfirmed(bob.channelId, BITCOIN_FUNDING_DEPTHOK, 42, 0, fundingTx)), minVersion = 3)
        val channelReady = actionsBob.findOutgoingMessage<ChannelReady>()
        assertIs<LNChannel<WaitForChannelReady>>(bob1)

        val bin1 = EncryptedChannelData.from(TestConstants.Bob.nodeParams.nodePrivateKey, bob1.ctx, bob1.state)
        println("wait_for_channel_ready: ${bin1.data}")

        val (alice1, actionsAlice) = alice.processEx(ChannelCommand.MessageReceived(channelReady), minVersion = 3)
        assertIs<LNChannel<WaitForFundingConfirmed>>(alice1)
        assertEquals(channelReady, alice1.state.deferred)

        assertTrue(actionsAlice.isEmpty()) // alice waits until she sees on-chain confirmations herself
        val (alice2, actionsAlice2) = alice1.processEx(ChannelCommand.WatchReceived(WatchEventConfirmed(alice.channelId, BITCOIN_FUNDING_DEPTHOK, 0, 42, fundingTx)), minVersion = 3)
        val channelReadyAlice = actionsAlice2.findOutgoingMessage<ChannelReady>()
        val (bob2, _) = bob1.processEx(ChannelCommand.MessageReceived(channelReadyAlice), minVersion = 3)
        assertIs<LNChannel<Normal>>(bob2)

        val bin2 = EncryptedChannelData.from(TestConstants.Bob.nodeParams.nodePrivateKey, bob2.ctx, bob2.state)
        println("normal: ${bin2.data}")

        val add1 = CMD_ADD_HTLC(
            10_000.msat,
            Lightning.randomBytes32(),
            CltvExpiryDelta(144).toCltvExpiry(TestConstants.defaultBlockHeight.toLong()),
            TestConstants.emptyOnionPacket,
            UUID.randomUUID()
        )
        val add2 = CMD_ADD_HTLC(
            10_000.msat,
            Lightning.randomBytes32(),
            CltvExpiryDelta(144).toCltvExpiry(TestConstants.defaultBlockHeight.toLong()),
            TestConstants.emptyOnionPacket,
            UUID.randomUUID()
        )
        val (alice3, actionsAlice3) = alice2.processEx(ChannelCommand.ExecuteCommand(add1), minVersion = 3)
        val (_, actionsAlice4) = alice3.processEx(ChannelCommand.ExecuteCommand(add2), minVersion = 3)
        val htlc1 = actionsAlice3.findOutgoingMessage<UpdateAddHtlc>()
        val htlc2 = actionsAlice4.findOutgoingMessage<UpdateAddHtlc>()

        val (bob3, _) = bob2.processEx(ChannelCommand.MessageReceived(htlc1), minVersion = 3)
        val (bob4, _) = bob3.processEx(ChannelCommand.MessageReceived(htlc2), minVersion = 3)
        val (bob5, _) = bob4.processEx(ChannelCommand.ExecuteCommand(add1), minVersion = 3)
        val (bob6, _) = bob5.processEx(ChannelCommand.ExecuteCommand(add2), minVersion = 3)

        assertIs<LNChannel<Normal>>(bob6)

        val bin3 = EncryptedChannelData.from(TestConstants.Bob.nodeParams.nodePrivateKey, bob6.ctx, bob6.state)
        println("normal_with_htlcs: ${bin3.data}")
    }

    @Test
    fun `read compatibility test data`() {
        // data was generated with lightning-kmp v1.5.0
        // README: it this test fails it means that we cannot decrypt and/or deserialize data created with an older version of the app !!
        val fundingTx = Transaction.read(
            "02000000000102be3b96e7a875d9f8a52c8506dd50b045ba760773abc1be9a406c34da36f46a660000000000000000002054feb112c4b73684ddcefe92e7c37224392d26d6417066056310888381ad3a0000000000000000000140420f00000000002200207a438ad7c24c367ff837ec2291f0a90f4aa366f92c61d5f8c47e8df154ad6c3f024830450221008a51c021e7d5900ea3375067e0a0341318d6f6c6817199c58f2723452c92822b02201bb6efdfc26affebd5c1635c0308ee7b5402ba7a794bc412834428f51aebc8a5012103f90063c081965dbe19b95985bdcc673563d2f18c32ab6eceb4e0db5b7df716c00247304402203b09e9a91b4762caf6990cb68d970fedb620049692b6dbcfb1641e29d771b6d302205a13ff683e7c57988af388b4e12e920d9dca619c53653e59522f53c77c2d6f9e012102b29aa237f857b258a37abaf49e1c6d0f5766c446ffb930f48363ef68c4eb7973801a0600"
        )
        val waitForFundingConfirmed = ByteVector.fromHex(
            "6ba70e923bc5a798feb63d92a039da4224a6128560e38be53f05ab180c03d2379942e524942b13a667d2c543dd9b790e988d542d9ac83c9ef9c1e348158c25ba4f87fb21ec9c4d0d755b1068459a51a371eca51565c5d080207ceb32fbf23dbd426d7b20692e6f1d1f4cc46f7161c196b0e0a8e470596407fe2576c985f4b510760a317d2ab01cc99cbaa75b5d7e537b28404d2e8e6756f0ef13490ee9822c71fd22ae9e55a8ae7a8af0387b8d0f1d742449ae829d23cbea83406259ae2f86e85c83e6a1eb39d5e1fb93ccab7db455ff9773b91313009e630770fdf0a6931ddc6f774d215d328973dd8fe7f62929e0c7a8e74c83bd59be2aa6f0b2639b251f0e12a9647013fc8f79b37f8444885c2c75503b856f6610c16085b91e3b284f2113642b6348160675923afd5a7aa7920b5ad1ca6ace05e92d5eb229e6457e450607dd0ca68e9c5d352db3cef41d925f59d1d35e0a7ebaa33072294adde757e90ba0ea3ad0f3f9eb7767fed30b091675155495a61c5762746655e6877fdbb881a01177c03a71c6a1cfbf73df0757668f047c4f9dd65326aaa015764744da19e776f6f83f0f06e4cc9294f707a80942c90ac5737e5acf776d627bbd2af7341e2be673f82c73218c2f70eacff71cd32eeabaa2fb316f957833e9f0b97730ec5582f028b4f110cc10877ad1ff8e674f8b7161aea188da527808b2e517ddfca4c0a3026f26b11e62e7f84136fb81ec0c853719c1e749b741e8ea24cf96cbabf515cbb864916966f0aed606255fb81d38a79b7aba4ee9e18ccac159bf229ff17a7db5c321489afb9b27160b9dd763e3326c1e606a68a42c242815a0c7c64a039007ad10b4bd672cfffbf173f57ebc435f394aea3cb03fe8c3f5c342fc9b8563a5a3b5fd4f6326fbec566a0dc133bae2a215669baf8b8cca2132bd55c728f44a2900b26ae05645c644f756b738f4de11f6089710f4c0af5dafc3a19ab2afe233451bb3208a4d89112afa907f1a8ea6b37d517d913bf38988e4d017e553016698110bcda61fe8d678bd911336c1cf311c2956abbce6992f40cc2a45b4c5aeaf856cb59a3d02612652a6aa4c3a54aa727a7193492f61d84911ea021cac760c677f60e26cb29a79f8dd07606fc31230e5b6875b76df6d1cb72779bc26a9560b0ff55c61466ab080534c0d831ab3397adc9c8b074cb04d8e114c6973379fb9799c4e78dac74ea01411365204cf890e96add59532ea08a9421fc1a12b7ff399bdb4ae5b5e37f5ad13d5ce4a28b96f9ef662327e1716d50ebaa58f724153ebe320b503d42700ac0889a200e98f51ca7b679fc72930f071232bf4498b06dc3d210e42ae7968ecb4736802257130b8c0bcdb4300c0dc4b749cc27723f45854ddc233bb24ce3a9557f9e745fe223ae5e053ce45800515935cc297375fbc1c79581fae4100bf0f3689e7dea85d11c1286314df5aa55e3d48730d1528d582d4847162be081ac06a2ab3d4ce668ecc7f36a7f16181bf58f3a86766796ddedbd5b3b2e053dd993bd63b653d912b2d9e3fabcda9b7512c754f7e3e31895ec1adeb76bcf6b719c6aeb632049f5ef1a614832117cf7f0cf1c18693af40296462e2b9177984d668f3380ccca1a63343e6858712b0ae67c87ea3dbb8ea0acd22d35e7f4ef83aefe0bd330e9c93f7ebf5d96e2647e72cabcaaac983a46bb9095d1d8b99eb3999e75d97a02b2eee2d41e4d7f499ad1c0c524e80ac6dceacf5b5b6f271140f4e42feb882c11b77d969f43f6d5d1d7f60e20d8538e9340ca7db5d06c1942eb0785da37bc78db17ebf8b2353e30869b2d7ee40eb0b56ba658bc16b6387a4a5ca95cdb3550e0e918d52c49a6404520e7068c08d94e5d9c19ee79e0117b78c10d59f125245a1c2d06c904ea4ade9b3eed07494d813d060189f7c523803fc538407b0d08e3eade5a2a64933ea9924c89ca6b219041d41171361b260f452a4c006429d74f56bf1c37b55b725a59d7cc52a9884e2a407dcc363871758a06793cafa8a16b50f9ddbbb19cb4607f54dfe71a2432d5cf320f41b39c7f175d1aab167c27785e2f975292474b7541322b198e7c7c4072bb9d95d7dfbd2b5f30364aaf31505c99b14144f113caccd32411b1eb8a692d1224ba6c5efcdfa3e892fb3009d6e6e53e8be30fbdb94733ecab0d4b86c703657019470dcbe7cbd3dfd2321f51870377ccc5dd74505e23489c86468f9e43c09e68c24773fa8766d4aa5cb492edd4b4f53384ba9e1c8d419d48f993ea94ceb57f6c41f191cdda12d6762727a11daef4404bc8fc5fc471ca169d43ed108c73685cf718ab0521c74fa110502e336b7eec0d7b077b29d69546a78b3624a2198d6e3a64858f9fe9629b92f3a653c8fb728f6ad2f96f3a1721503d2055302535ee8d01443429436091a89edb5f98d1151d61e59fe031cfbccddaec4d25023eae853cd9a9878f0e5187426787abc1bb68083c214328d48068ab36dcbc571ddcaa44ab3d2886b0c5ff885855bd38b32d2005f77ee7c5ef3424b4d2a102ca308290391e3a4267e6b45e382585f2cc5520756add3b0371f0fb9460b00dd85a99933f604e936643876caa47d1cfb656a3162fc777851dbff7ab9e34fdc81cd90c3beafa3d3009c8ba86b89c1ca81982830dfeb16dd00eefae1535c3d0949d265b3115dbe4159a781eb2ccdad923bf79c860c12f90122044f3deb8e9b755539d0e308fa5c42dbfa4ec332e681f183600e658b5046dd5254d214122c755a720b9da82ecf0b1a63a292a8177bf651c22ccea52fac44e2aa15f6aad37a376e75699300392d74b591ab14bdb8ea689049027b35c56a061941814f71a4c439e24736d4d46edfdd6d3200b35c44235097e3851d0c4166a55bca29d1430130be87abfe5fd9d1ea20a536d341f8b572cdfd1c580434c8da8aa2c4c3c402952315e02d565901c3d985361a99d30d8e73da557705e0a60cf1d3ab71adbc756fe4ab64c3185c5f67ca812cae9482f32c390da5f45367749e9c7d95f9a6e1a4e27830a28fd5ec6640c49fd3c3a353be3f504cd6e2fa27bff2a16dfdf090e485be79d4576e01ff244f73e2960d34b6bed716ad3ec13286dde2ccfd2b8e938168bd8d8c810f9642c42ffa8dbe790753c8339bed0b416c1aaf9810ad34ab8df6c7a64119673331615563a00c08a68cf80ca956ecab6cc69dc251ccb6282a933f2fd14a0d2aeedbc665370430888f7c341435d498fa41820a65ce693ad5e9ae8a8435bb607479e744755d7643fd8f4777b85694bb9e90c333f797807d63f604f62e3df7884894ff231a9fbfff753f58da15d06e8d1204767fa14825f4fa49f50921b0fadf5e07bcbe2d274696a892a3c8360d70b73aa4c6f7730070088dc653946ac437fa982bd0ee51fcb6f1368197191747675aec6e441c5f559ebc1a102d27f228392c31e5cf7d056d707339146ba8bca47b6c79e2e1f2c70a8b59e9f55d74543e790e1e2969ce1e9f40d326e2ca53a36b3a9f8a224645299eaaf8c872789844707e494c22beeda7c364d61ce160e15dbe5c99096a1b32ce3269799c5c99e3dc2c1c5cc2a772c01baed9f7d7254a24b42d3eef8dc587c86131574325a3499e45f8e1954634e444e578795a2aa403c17f65017b579cdb6ea7185c99bf01cbb1f739b9398c345b1bd2e8be7122499fcec02c1e9cb575dae2bb8518117023db4aa3414179bed472f359ebc9c63f65c169d4a4620ef4af6da0791fbf20741c63393e8bb0d5729a7613a1f1191f8d180efef61cb0858abe6588ccd3d3266fda3137ffecdca641a5a4d04ebc3836407e38a9e00ff31add0b3bfb2664f095db28a7c1c6098db509d30dd6b5a26dbbf989bdfb54af0cd188b45aa958f23a72aba4ea8b398b4e5ce2a1a0bcf5edc044d277004832ad35e35d7cf4064b65cd3bfd50ba77b2546af64923eef5cfa213281757362b6709d272455517376236aac3400edd21585509564e86fe2afaaba40fffcc391755e0f10f62aa063b00cb19a7475059bb536db247d39cda8b46162b3c553529560faeb745442c39d4b9d9f6c83ea5d0d687a935f0cf2e8098a1f0bcab2eeea7258261f930ff0c01d39e9166e0db5b212533e2990529c2abee0d54c85ef5a07521d346b12bce370d92a4fb4fd341e1ed1bc8ab5f73211b5d561ffe6bcfb0f6e9fb448051dc107234e3ccfdfa6576e6967c8fcbf56901853bc263b73d784e7b6f30a71875ab2479e4a3908651070b1f2faa5d585dbf3e95affe647e849fbe7ef30c3310d01eb8f6e368cf86980df757fe3db84299590db583d94c517ce52c2252a5bfd4daf05469a859ff59fab38b0dd7dcb02416d7cd954b38b71d1a3c3db886fba01ce1902e7a50b4919874c91bc4eeab242e19792294bd8aaf138482b31acb98f68004c1d8ec4cc702c16df15eb5d05b9e3a5aba30a3f3a85c3fc2a9ac96f09c3d59a0b34c1550a602d523a5b4590525a660866cedbe17379bbab1b0d5895c8393981ab15445f0729378ca33601365108a8a3d2e7738c90d94021e138078d29a3f326a704010b5f8d4304b0a61428b7693f5d5fe13d64449ca83434f817e20003a3feec3b9a9ee2f3e54ac2c90b52ef03544cbe0363209e211adb3cf18a89328968fb68b770796643b1b706cb7b36cebcfd18d269810ce61da29687f3e5390f32f3988250d4f1acbcac5ef723aa702ca5826a0f759977a27563f013543da62828aba7edbbea69848ae1ef8e68f3e2adc79f7c2d161ff449df68f65e63b696b4979edadd99c5222a55aae480387a811fc5de2dd30ac999731edd76306e00f11668be957f58371724b13fac524a4de8cf77c7e3e7a19ed105b67f2e519f7a1bfafdfe86866aad4c29cfb96747ef021141597440257090077a86c118c42a0856b3555ef5a3e748f85f79028a87fc99aa03be0946f36b109b293511b66979d66f36ab4f6b8cea7e74b9a920a87a7651083beda0bb8b4feed7b2124362c0e4d1c1e5baaf2d63d2d844321cf7a79530f591d9bd0d95e8f74b24f2ecad57531462d0d1a161c293c4946acec1d762eac2aedc7bb16d659ac49f651f93de946e2feedd40cbf9ea24a2890cf3cf9a280fbc10bdd017edee56b3871b71e678b4c81fd639df5d757e3683a3829b5087acace5eccb6fbce2aa799cfb46d2426b6c38c6de9d5692218327361d75a304fc374e6ec22fc584e4a26696c40ed9785cbbe9629f8ed801f9d7d41d344a7928d54e523b51f142f8c83d9e21c76a48e8ab4de9b3b8b2382a0bfb9394f77f71b0a4af11ef326f14cacf7ff9a7f431accda44d5506f216b9600355d068835145c6cc639ace88f76615398ba5f6eb6b9795183d15f372fa2764f74c4b1f074588fc62a956fafd52e7105b5e29eea3a47cf7887d2144e278b4169b943f4b33a382cf47e880b423687348126ea254e76ce8857c94f842df1c73a99e4c7ea2b655dc15f1057b829a2050e9fc94b882ff4feacc6715b84ab597d22bd8e1f55358ed15f723ad66bf3b1fcf3276037f9d948651c2c8b7006e2b338057594104a89b67b8e8432bdd1583e9e34d192285fcd5a37cb913b40ef0c472d9d089602bcb6574c21922e9d01823608646600b9d1991c97751a4e89855e78ce21ae0f2e6d518c1d6da41d15d9c633cd17687ff74e8b85c99f109ef4e54395c31c4dd8bfe1652fd34170e6a1037ab925aca867f8d9e13e53820e1a76a834a0f588a49fb5631793424cdeaf6e7c05b82d16439a0e2de2341a068f4811682b4ada8f79271315a349a15d95d934a47ddbcf0cd2058a5a50f9651dc1799baa63a8b209da84e1f10ff0c0cedf2c301f7dcf9f47be56e83872a9f6b7911d7de07c488b268dd18a99778186a60a9e21444f09879e794a9deac56c794d1efba0cd089effa12861f964f00bb55d8cf1c0fbefed6c0fad0af8bfa493e0a33f80d9d6d5927b403960c42d0605c920236d69b9c15cdbea938cae477abf485b6bf4db38448b684e5f8e020514a154c946237055a78f4c3375fd749d2bd5b6b86a5a35c50479ec59f047fcab0f8b974b6062b813b16ec5931d93300ce6b89b4ecbd3ee72071ad105ca9f4399d563533ca608759873d55f0acf4ec14f5e5d321ef94ad3bf237227d275b6e7a4f9074a97c70dcab976cc82faa458fee65d"
        )
        val state = ChannelStateWithCommitments.from(TestConstants.Bob.nodeParams.nodePrivateKey, EncryptedChannelData(waitForFundingConfirmed))
        assertIs<WaitForFundingConfirmed>(state)
        assertEquals(state.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
        val waitForChannelReady = ByteVector.fromHex(
            "b257c1a2b3af8a42f33f5c5ec8c4349d3e4e32d99e2eb05390de3b59e83a051f193ed300a93e4c1d96c30d0b0ce687512eb802ca6123c7350010ca68af09c187951c4cc8fa15d8b59433dc3af3e2f5d40c1c765329ce640bad0097f249559d577ebae74f4c006a8c8bb7518275475ef56ed0a281080d5b21908f53bb384bb1c79e345317502bb4a39d811f21a42985dc6d594d163d283d0103029daff8bdc82bd9b9430a879cfff739f8332209a6bd06b7d8676d09692ec6f397dff585768a7be5c69ca2ae3c75675ae6f1fc3cd75924ac45ccda5e7986df6f5acd03fa57856592ccfb4cef507fbe5be135a17d7aa0a3af519ae003e95ea7da6a1f71fc8b56a96ed8fde9ef92961086d2a0a5ae844d9c5db79eec0795d12c5670e401d05bc92b19992622417fb4c0db9e9ca9fe05157f45699e0e0b63c4775c69f086ce6dbdb1335b4140b5581999063f08f8d8182e4625b7ad4f49d8d304c6d659e151bb1491e66852aafe5e11f1b6cb0aefe6cf9ff1ab2d964ba26c6f20006bf50315cf8d873ca07eab2685e34ba391f753b930dac52d1490f5060facbfc897a6e345cea84ba7828fd342ac59ca8de3d16cddffa23d8e4c9e20ae1d3fba35a9a99740f360345ff21576c5a49d0a34e81f2426eec59261b47b85be8f854d619b652bb368f85257a18aec1b28a6c789bf3c6612bcab2aab1ca0653127ff803cd5b3c7547734b20592a574d1fba04a12f45208ddfa26f443468e0ca7d7eb0aec4f42e7713d66d4bdeff508666ef08575051f2ac51e81a6070f45561b5cb852c03877a1f437c191ead08e2586982ec0eb39c8271b29bdb02a0d2bb540552339fae902e9fa285267bb5292bd842d3b5eb1f3f1b520c8be37e9d63a783d789c12cef94a525bbd47bf6309d129fa70fcab675a1e3907f1be66c611d5c5238f2136fda231519d0bbdbf55d590efd920b39c2c056e654996ffc1b58e20e5517094bcb8104e317653ee0688dda8217394b6016c12a734651f92e1fa7a2785e73dc21494be2217dde8b1743941bbfa9b1fd8a209f328a7cd98a718b57113fa83318f49c28d8865b206d681ed8ae22926312dc6a48f4155e1d7b0ed7a9f369c45a6b075d71931f561b5f554788ce6e5e5f0dbbe5c471469f9e04becb420bd330a59c80fea9199745ab45f1077f0d5af7cf1ac91f4dd0b80ce80df19a529292147e1096ee7b75a42c132a1e2c8b6b87ae9bc277e324e98cd55d5854a15f1a2280540f922fab2f598b74cf74537fb721002aa2afce0fb5ccd3d58425e8873dab3a6e4a2a5a07f1e1ebfaa54f69abc8306b110c5968aab7ef075e246f26f54d441d9900837018478d39c43a9c574ffc59c5d4bea4adab6e92e70af0ede2fb9347982c96fb978968088ee8f0be1765d36b81c9b32fc8ad47023bc152aad8e33fe60342c14bdf2be02cfc13ab4678f9104324502d4bbb9a240dc32719305afa707e82b7e76762e6930bfeca79cd39001cc30e18c09326080e38a990aa973bb46ce270b532378c1ae75ea7e5b0f24e42eb69789ec9ddf081eadd7583f3ed691ec1329d0eefc4055522e803089b1f78e4a33d818dcf3b125e06753ec3a7ba9ba7d8aa59ddeb0a93ab2edee5f62e50682f4ccccbfbf80598a5900aa8edb72dd4ba3a65676a7ac45d25c6e94da7b800b452600c94d8e1bfcf563b09b2f6481e327c71f1d691d4cb564d363996018d6a645cc50133b1fcce48cdb1874186085183ea4eebc4589bfa2a45a3aff999e812c702e9b150c2f3057cde45685d239d3eb9a6da59269bbc38a7b33227c939b236ef5ed0ff1c9cbda95fc5b04f28eef6e1657ff46bfdf6d84ec90e867b98cc1ece2dc7279e80af74badd18a5926351b7e7d4742a18a29a3c24b2686be8a74c2eaada621349594ab4fa5ff1d2c34e4b466145b1d3a3d74162f334f40dcc6834b094b11a22e46f1e3ac3ea2fba14713746507f86d323c4ccc5aed475ef33e3c6d23127156e9f461b74c300b4cc2433e8959aae79d6736b8aeb03ed4c517f29fd553fd53fc6cff33ceedc962ba56552901751bd05d3871bd983e7a34aef21b695e854fc4f27b5225b0589832d0ec9481ed249f7bf4cb7397d0264739cc1826b4859c3bb8d943da95da775474458ed3d8f1da0f0bad107495c4c345c5bb169af45dd083bad4721f81b96f2528f8ed2879c7d3ff9ceb6e0a7664a540602483afa7204851225eb187f99e695f8211123f7d9d9befc901e1d1448d9a364b4c081af686ef09b0f04da9559d6c02cb589d4c9e3db1d7f65444c8fcec0fa3ac81c5354c09534fa4770c7e72e8f23e60a3515126ad5c6f3cb7944da9dba263cc08b9590db4018c75e17a3f8012ee098c29da9d485a3886d7056ee38594eb1f88078b802ab147b9716b0dfd34092d7f2276fb37d395d1e7cdd68c0a247c3ca88ab411fb72ff9949cca6ad488dceb1ff73577b1c977355125053f328fcf4b92398164d2b759b55b0282d0871852b0152e8ecd899bab32c9f8089c1f48c7713901dcbf3a7e248a41cceaf88da81891eb439eb0007ea198d39ecc00c1d42b3dff9b790b530b2dfd9caa83bf622dcbb1292afb2e907abb8f081a551cd16468cef7d0f0762751258d36714e48cc53cb9e6c3a65bf75cdd92409af785e2caac78c5c8b3a86ae8b31c04f6c9277c254fabb76de44d87bc82d8a2948811c7a2dab72829fbb9f8301ea904a50c4c6ebb6dd27f05fb522eccea4a3c9d9da271d3102fa6819a5836ef3012cf49c7ca837573d7a3458f3faf781e19a610c8bf0d0da0dc267fc90544798f48a67bc6c489f5a2f6e60680b08ef0b57c1ade7cbc715984da708b3aebffda0d1ce3cc04884f009854a8b377358a9e715a6116c1703c1b6c63af0cf015f146163e60bcb408e33a3786110f0d526497e324e6f25e5fb72cf609858dbf2d7d88ff675c533ca72a93bb7fd23b24b0879e6ed9cf66bf45df8af58357a175c598f3c2ad2ccf8c84182419f1b053d632da93c308deff498f48083c14338bcd49bd3a39a5a443642af85be0c2f4ca421b69c64cbfcefbf66208c9ba819660b4a7ecd3632ed78325865462e609a19cf915adc0d4772c48ee3eec37bc5cd2028e2e94956095a87b5bc78dfb3615e96bb0b1bc9a7f94da0fc4e901d985875e5b029d7f44dfa04f6b3a36103e60da58c699caed25759b01cca778fa5a8cd11e3a36217d89bc99dbee1767668783b9d3aadab77226396d847884c8bb49b146fb26d793c12be3e0dd956feb01881289bf1a3700e889366f342c4d5a1976a1a4e02676546a6e99701438813ae1bc625602c36166a4ba34900b7a8e0b40c7a0a86b34c8a7702a7733c00590d9cd4edf3080ecf871dfef6db6669dc75826ddc48673a46c76598151abfbaaec1b2d48009b277785e06cd5e92058e763b9221dcf4727cc6cffe27424c266592986b782e168ff9d059d691afd4fc740be41510b22fccc26933ac608008c212f9934c82c79aeffb1228e77a57a1ebe84cbc9aa04136fd0576cb6ea6217a5979698b17f1d9ecddb4fed4405b7b97ca5463520291f068697cf14d8d7e62df8b1d04577d5671c4dd2e937fb2e131441dc948416085df8423be2a5e875e0ca00361653c41d021d80a9cfa077f91b5194bf358bb48843e42b7e26e7874e17ba757de8dab85c5434137d78f5036ef6f766a3eef56a9319a0f4c9b9742ceb146b36c63389dfc473c11befd48c0d5c3a14da00ce87bc1dc52ff50ca22ed63239755ebed696680b0f0933f3abe31f60f134cc8ab43ceb0c795dddc7b662090e1d2ac87ad17b0efcde67931959b02259b3f1833a4f2475eb563832203c5986ac7a818a91498d65bc1f7195dafbc6c00e1464f0888d5af0868500c2efa776c9b2214ebfebf0d608c18496d5def954c5cd402652d719987f6072b013da9ee37b178ba470be49d38550f4c0b0cacffc27d27f41f7e485135b5c2c7b82c1ad37c975cbd5a98e8829f7abc28d883a5a22b349baa49c7678a1a7a5672011a68c44ee1db472bf3b261732a90b6121743e227734e05e7dfba2b72535442abe52362b7ca84fba50f4459e22acda29ba2817e6c8f45a711913515bdee72ce2140a135648e3f8d2712f2419aa933e2daa9298a6a91518573f043c3edec99c42bc49acfe8bdd1bed06dcdf36eafcafc4610331abb376ff239f372e4173b69441f4f76ed3e0ede7b8f000d9246563e6bfe3dd3dd85af3d326d77f21862b18eb4dd306a1cf9e7a3cb161f19a4b471efab8a6c8e2bb4de07235c2b0ebe840ccb7565dba90e73fa4ce7de7534667f3b0386201f39b209bae73526511d31903af31adf7dd0571a29dea3cb5f8ef157af8fbd710cf947a6b78df03c3bc11b2582b950401ee5455220b317c390ee11e0a07d07aef7fdce7e389c396eefd169757ce3568a0d3b1c8ea805bb104bab1b38eba7b5eafdab67298b28c8e1aa4b49188f34036b8a592628f9243d75f3424b71bbef10a7722a3c2d787921a78e9ebd5044824e16a2a5b5640dd9f23f68ffa7c9253283dfa39fbefa9cff4fe5cee8aa78dda424b99893986a072b6bca8a79c38caee5239a3411b1fd023e7f4126903e53a4054287e411826e1cfc21b8314070e566edcfe7d45efa23a233fb525ed6e71283026dac1493b3d9b71a3289aad5f63b8334870d96925796ebb11be8adbfe519218378b7a9252e0a92db36015f9b45018f0e12a083466f2644e9f3fc85488674f2c408f52eddaa8ed00b174098246d03b6c6fc8ff27baca740357d415d08417ca2f2cb646235532412b6c2ee19908966e2492703bd939d85f9f63d28e4c94d78f4e55c65d56a51a437e2e1335cdbc2cc0c8260a76e404b06e159285d751219c28a5344700c5669694206211b83aa6e31fb6119f56160ea5ca063cf481943c7a44b9b1281de3a2e17b6899edbd77a9507f84670a90ca81533f104a4426cd14e4b085e02b653005637a97a37a53e4ab120fa7e4badcc98f052d157fa716ed288771e1d96c7bcc453b3c1d877c2ca311d75777ffbd6de83885d192f88cb4c6237901c206c6eeb9652aa7c244d8630bbd8f73cb1d82618788ab85ae75016266817e3e84473bd23c2bc6a4d35e2ffda75411ef351b06b00690dc9b89468138e1de94aaaf54a324e552cbbef15551d9079130ac469694e670ea9a7c8b809b5d15cbde1d06de416c1d99efd1608bbc6825a7de80cf3109929e1a821a27762574f8073c75db4ef1cc47d74e5f4a375836460e1b3f02fe3e8a8648685e807b7a8fc82be6d10216859aea4f7809f2834a884ac77ae22a68a3719d13c890c820dcf947cc299596fc63087056e93d78206353f0eee00dab9c79b451e6f6ed26e7ad21415e4a25847fac2028e33ca1ae42288b12682ccdc7a93234971aed16f69f49bd15520559a0ef68466e10435408b8b1ea1bda3a8ba11f78bb30e736d5bbb5cfd545086afb147a8eb58e1800ce4414d61fdb4b5589029f20b08210803c270bb70d2aacc276735a9c69b370725d07f6927ee9ec2016ab2b9c504534aa3369ca593a3acdb226ec5d9e0b79220d834ee6400b71a4a5b94898f08a69c39270429deb137bcf15656ee9576f0eaf208ff3830e8bc850f565bf19e80877b426b8b25762efb1db14734dad65ed2ea30b26196ce674b0eed120d025a07f500c8cce17408877abaaeb009e4304fe11e61c536d4a36877a907f1ab026a4aaf9edf4df28fcfda6511f30b2d99ed1a9901acaae66977f9b16e32c2e5e77d9cacb946776b371d03c1636d972439d0f7fdec5d46028e7df09c5b626351f882b7782f241ddcaee1ad045cd1afe40b2bb8b7a8072ea34092f70300ade657891581c6984fbb1031cf8f4424b7a9b6d6ba093dc7838a2bbb5d6a34cda7b096f6289560fc9f7ec769ba25bad84ffde3aa77513b83f297416fc1a422a9833317134d3072788ffc426009d63bed1e921442f3da743daaffc36c111d6e8e51040410e2bd1b07527f8d19a81e93eb153780ed72298d705214bcb47b84a5495e857e12b5af85e11cc4927d9e148bf5bf9779db4b4389cf268b99aab339e91f4fa61879506895cd9ee4b62d7f0a46c3087665400bc84752e8f8cd2ecb229858f6f733b2b151634320bf4c59069c21f475d8d486b78ae27759b139034f530b94e16a9c2a04cabcaac51d5092be9c95fe4dd6aadc0044fd9adc2d414a382136bb4aeea4913477d461361080a6410a8807c8ee5a110f0b41eea9472314afcd46ef5295a7056b3a3feacd6942c691b8b3c88ca2383f6ac800ed9b6ef6d5ad53def06ac171def138058bcdde6bc3f3bcf5537dfc71c959dd65fabb42fc09bf2b53c45a846c5"
        )
        val state1 = ChannelStateWithCommitments.from(TestConstants.Bob.nodeParams.nodePrivateKey, EncryptedChannelData(waitForChannelReady))
        assertIs<WaitForChannelReady>(state1)
        assertEquals(state1.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state1.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
        val normal = ByteVector.fromHex(
            "552461dd239362a2f9f197d5e14c3db032efcb84426ee7900b9497e361c39e4d0e862a92e673be863c90ab1c7db460c244b072e67a3799fcb704ea49eab99113bcbb3ab275c56d813a657572ae2028375c9d0ec705ec034e6be034c77e40117d845c7ed5770e6cff2d47eb2b76824586e7439fac42fe472ce0bbf82087afb09b8990beef3484fe9306014b310a4ffe55073006fac8573b799672140e143a0d78204cc7ed3d19a98da112a98e0b2cfb874128823e38e0c75fc7da534704eb4b3219aad09aac87af2c2b10941ab9696569628a841b7319fd44cb91ab730f0842b00960326b9db4ae2715c94dc068f02350f5a52b89bccfcb9f59b9da1fbdafc7346bf3334034202d78f26d60b2b02e80a6d4a83d0cd88943b61817d970659e22cd8e55fb0d28bfe43a8fd8776359b9553a66b0c7a0cc883725069a16cb06cb98bcc1afaf9a584658f4743868378023cb016737a82db114562f6381d54eed55024b7aefb671731db70a56bf9a27a2265af48f281880626669fb8f292685c81563cd3c38bb23ac24bb1d09708343a952a0a1c25bfaa58c92b75eda26aab00e27798f4363120bea3e5137221da2253865634f094bf2cb989c124b4bd2f2ad7049aea40a58112eb2f0928b32b4f045753120b35877fda116bf2844f2d083704f8ab150ca4d563f0de50adcd4827f2b10652d19bee9cd710627536a33b326ba87b7fac4e6c8f4d59f69131832f3db6541251c9388435c05711d2a81f9d87b5f63ea8d070b1b9219c75cc7d60530353d4d9fa6e3e82ac1da226f1a9d53b2daa3c65a32a4f3a18408d2c5f9c591745395f8b2ba137edb6830e7aa7b17a14888de4d8ed2bbf33217b5bde718aeecfc86006b34a90d7b7497511b3f575455c15bd63f3bb2dc70c387499f946fa60d33599acadbbeeddd458cd10c3389f35efbba95bebaaf2ef2c43bf7eb6fec79a48af6afb22863c51279ffbb668c076d1f4f4ceb9e2cb676104db113c11e5643e12b3b3d5379fd98fcd139380538e88d59a64f81bea4024dfa38f77d58427edca56d6b21a48e47ce084934d5abdd61a261d8f50b2ef83556a038d84c99162b11427c886e6e836fe1d4c186eabc8ec8d734faf2ea41af775115a9e311310df3a8a2a215350ac8ae4c253c0e2f229254a585b10da224d344662ef3e853e23f9047c2fd3b559319ae9ad6bc1b5c3405c26500b5dfd9d8e939d83b76387c54413b59bf4ebb0e7ac25c80a12e1064dc519750943e21eec1e2892dc9e8373cd1c1c95ad0927e3262853f5abbff07ddb2bed56b0b39814d4b73cc44f9ac0ff1b7f1ebecb30aa94b36679daac04d3c1bd3a9134d0e6847b2aac38a34f857ea33a5507a41364db48ed8f021f7086166614acc2b2968e4df7d0a446ad0a88dc64d007eb0a0abbcf817b85aeb7afda1d47ec413234bbddf462d26d5089297ea57c132c58ee2ec6add11cfe7a4e8d4a1615857fa36ef154f21ec4969578cb9f2bfb7e02156b5207b6f96fc28633b76e8aad11912fc54d5e9f15fff61dfb8ea85db3ecce3a8bdf1f7f58b030259249dc30cf8b67658526f48b56310313ccc5486d39953b9404bb0db9537ec872660e6296d7f68bc3a559e8c5a5a452aed358077d53ef89a30ab54cc8b255f3a8dec7cc8ab3b212971e9dfb7828b979c21f818c12cc160344fce7e4d3dfaee3017e7ff1c9c13dfaa03b24f49da9eee04cdd7efed125087c3ee66790b657b48ab639355313f6957ec0a92a98393a75f96aa62cde5884f05a4bd5c593f77c399b7bbcc20cf9cc390df6eafdb775929fd022b35b6eae69b2f9c99f89a899f1481a593eabf2f899d900b25840c5b8a4f72846b6ec5ca1bef9df1572aa8371d13290b4a0171c53c2745024877790fb54a6b3062834062b9daa61ee833346c65a6cae431b3cb9f37678f4ff30ce28dda840a326b1a2bd4036f97a98bfa47993221170b856dfb5c99f626c30054b4ac0f11a110152c13111973e7e87be5a98ceea33fee7615bf1dcd13164b5f3cb6ef790930ac0685f82444bb01dccfdf1834946fb0e73a7c1e865d98278f77080fa402f219bc6c0a273fb6ef8edc822873be9b390007ca58ff83c161993480d4051abf76c8a1b480268485c4de8f3b6289090900f1a006e27d1edfe2c583dd37bbfa5f0e0e6995651388ce0732648bc0100db9b3e12eefe07adb6746895a2e1b9b2ea69109022c5febce6956fa09e9c2dd74c4548f8b42462e4eeb35703f2cbab0a7525dd7753dec4a74a8f71ad715bbb302ae7aa4183ea55ec44a3241c69ef3de489e3099b728dc8a7acd58bc9d774764f8c4c314288a9cbb6600b201ef2a44d9392d1657986d212d81afbdd423e5c1c16f52a5456c640a8c98d4eb3d1709bf8e7000da95af10eebabe28bfc68441d3f56ea3483a847ed6ecab2e3039625a69dc2d134083e4e9dedd593a68512829fec655ba4b42a014b31e1a76513d7610a12b002a2ccaacd6745ee88f494b3ee468c3a45e7994a014287b48e1d76ada127fa422eced570fc9624b1d8d48d9e5a7450843220ec908dbe7c45e2ae7cae84cbc24074bbbe506c7a752a6dbd7f4d1da730e7acb46bf45163ab900a5df57cfc6cf4b686fa3f8809a1986a8f449ee981dfbc4be3350db71425dd461fb7b64216dcd79a9593db6198982d873a7da513601c6fee1cbdee51f88dbe89dc3ce3125e61a3e65e24be7760f5e3023a13a27c42bbac4ab7fa832c99c42911539ebafdc10b8bb0fdbe3fb5b09ef8809de254c047436f2f994368d16be8ae90c3e0523072b7cbd71b8cbb2d690f576270697df50934ca2e7822f5f2ab040d24d311dc323d67a741a0f121d4a2728a5076bcb859b114c2f30df3363c31a39a7402f0279cd6161b066afe3804a1aa748bd8c6eeb7dec651c6708e963f9b2ea7f68fb35bdb5f4bfd3760f962fdd96d590f41e16603af32c07559f09af19746ee9c2aefe585a26c4b357efa253ca0424f7e9eafc13fc15e57771c463cee293274b3e33bbf3786b1db824a598e463c3f458510b80668b6d1726b275cc51ca1ab03f223bc3d594ce77a23773d322a6808f16544441d4d8d65f97cfe56d1937348aefa9eecde003d23db246f6e7ef11a069bfaaae3726c98ed426013967a3cb73ebb77d8b17b0b8072fa538bd0d3d0d26f993ea3130bd1d19209a44346aabdd8b559bbd514168ec060212f25028dcdb3415c0afd446d628fc930d9c8650d68d7f4c1274fe412441a56020839110aa8f6fcd1dbeffa1b1fce6b9cfa2babf2259e3fd16dcbfd96f6296dd40ae9984cc0e1a4a21f1fe345eb5f1e19969ad2be5a73da297eb084e73c5beb91268f4cb509eedf070e7ed9deba8b4e97a8f733860d3bd177fe36408b3f13d26f76b9da35eaed6b6eb4deec473ab20b71df6106b48ff9b9cb72dff76daed79fad350548cde03256e9e3606151060bfd79e3968d791a888ff423a9586ce14b209b8822a76926304ec420daba15f80dbe1fc2f96157ef8117d521b58d6e5ef61ecec5d7bb8071e6ebe8389b83a5d82dbce56720b31eafcb111166cec998ca1c4fb38de589029e187bf1728900d8782f9c8a19bf10806b56b17313339af3ca109fb15d4c3a318df727d6de4021a36e2db7956763db04950c0cfee1afd8dd73a73adca5b88febe19ea2827bae09a5f8e7c6bf1873432961b9839731395152170c59c658548029f057a139ab17a1dbc4e45d3f35eb2b252ed9957db7c08412ad4653613dedfb22b926609d58567b35da0e060ef96b3f0e1e913a6950568eaaeadefe361fcd0f66c2238e02d0626d4b8bbcc9bc3d0125656c8136d834df25ec7c86ce9e837b75c5eddb1d508f31c3dca8738da2bd573e47abb676d2ebcf2a7cc49f9813d090e95e6bf8dae9cd4d2df3bcb1ab104430422165f86b003ac90a241ab9d2daaff957acb8c163134f1fbf9deffe9ad8028e7e5d1ba82b2953c11fdfff7c39d7c85425395c3084b8521fe305fa41798df59eda828b4977e03fa85e6bd30a221c0ac23c3796c200ff768f161d45bd6a045fa0bd36be3de1008abdcc9b518a665e83980fde06b27ed2e72ed402b8ea8059d37c57e9c5bf22151528f05806fc90b1fe36c4d3419c74fa66b42d16308cadd4c3f557dfa3535df2243636409d4cbd4eec300b737cbd90f3c9eecfd1e7feefd9f341ba7a5b6657509390ff4cd59acf3862128d5c2b30189bb2ebdbcc7d390654c0fa9ec7915ca779e6bc75c82421027d681b5f5cdf32e11a8981fa40f68b27bd5b03bbedc88fa730e0feff37a5d9380916a5a80709392b42f3b6e8c5ff4ad21e7318f6cb784b4ae11fa20344be2ed46d844b48e9cd3b55844cfc6de75fb79236de6589a5613098531f61bb7996903d5064e91e11891fa0dc57f6847d6bf95c88d7fc7d942fa4b139ed54d8e85aecfe06f5667f4e2228d5c388af19e42fd9c0abdcbfb048909a54de2131939de8e0b1f7a7e439a01acacf5e33129e28d6e33e3f8579a61e9949e8761684439ac49475ded05955bb3350219bc2a82a14847bcf0e0c11acf42c975a5586fc457b406b164033577d5e13d9a1d9fa642195d8bced0d9c0e750f80d31deb415fd515e93787853bde84a9b3e282254306807fc4aa08c7e050a8cae4a7f9665cd3a123f1bea33cf898ab2414974dc919115994c4c8fa2cee3b126e570a31897d882d6e9064bce1b48c3e83672560169b5103b8d5f69cd8a06a160027af0a56407ca96738c1576af6d60cda755d8cd0a474f2d8ccff1ded2728ea3b83aaea2b84fdbd4191a348e10dbfb531cf07892bcaf56fbe17113123c0f51c3c264e5095d59a3755e0fbaf630a339a2b4720d88b5e90518a674a0e5cb68066dab83a27de98388c9c7de6775f6744cbc1f110f7a538bb7ec318c731b104de666ef395985eed6d099ba50f3c7a4c516365402ed46d668d7035d340b39ae230631f5addc131e6a9036f3cd441c001d841454b4eea1218a6ed25f9bd0af2bfb0a5b9591708c972c71bc1f2705c9c50b54ef7d508f8676fa7bb8694dd88c2fbe2d0ff8faba7fcfe86f3a1098f727d16c86002cd372db0ed9c5a8298a117b585f8cb674f98de1c094a1e694793822ec01eb9a4f4cae10061c022143d8f99ec3afefbaa52fa5db6ad534ce07754dd4eece35932b49bc2cdda982954317c37b5a50e692aed64e310536e29814feb16c14b5297ff52c36b5d20e0e8bee9cc083c6cff11afd915886f929e7a00bdaafee5535eab5fd2feeec4439dff11cb16a692f19"
        )
        val state2 = ChannelStateWithCommitments.from(TestConstants.Bob.nodeParams.nodePrivateKey, EncryptedChannelData(normal))
        assertIs<Normal>(state2)
        assertEquals(state2.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state2.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
        val normalWithHtlcs = ByteVector.fromHex(
            "f8ff62469fce641cf4a655089f3d73c0e50f08719a4879ae59ac4d316a52c9a7bd17cec2b290bd505785724bf69dacd3a50738f51e87c7bfa7834353183e119d3cc76e3827bb9dfab32008c2dbcf86bfe6b0592ff057147ef9653eb84810ab25df333133b113d76eb6ad03bb3b3d8adcd351a3a3264523826332236b78b5858d01e274c604a1c78fd7ef87297564faeb883032e28fafb6a1a995765c0c4c3bd7ffc4b31f68f08fde49a33f994cdee7a3abe0cb55fb066162725b01205b64a84090e9582d2b6017fe57de9887718474f06305ce30ea56bed562d7f8421ddf1ab62093e9382263bba5de1fd1afa97be65577150c416599f6f30f8ee527a91fa8c56bfb99d3961e1f0cb5f9f8ff47c57d1d3a301d39473e1ffe9ed299d612661ed18114cc5d8215c92a597bd98314e18d2817aee994ab57a314337d577ead2e45394359d9c9b4567b54c4326d09faaab07acf7903c21487ade4a26315996b0b447f4038414765114e432add84fdf11e2a96db152d9d765c0b30e59bf023657295f371e80d48a16ff77568cc2c2ba15a38695f12ad79606be74e0f9dc69f392345610f84a04ac40c6a640747aa786ae9b832ed2582bdc14a74f380953d774a6734d3bc29680cd4816893dfc0506e7e3e11d734043f0e8922d5d4b0bd7440a5963d8138e9aa3237192f4c747d99b7d9c2e6f1609e6f653131718ac21cebe1dd71ba26c6a598ae2bd887c17e609513ebebc938e3e9235f3603c9ff1891424f2fa2206b7e2d8fc3627913c9974f23af1e21b59f5a98183c184a674aa68eb8544d55b5b34bf56de3c48dea0dd582702a4354c825cde94b932eb7941152648654eddd2ef7582c00a7e68dd04d1adc783a452ca7fd37cfd090e488fd0c1a65c6d25a0aa92fe3f47924c3765bd6a38a6b2060d558da0adfe5fb29c91b1908679533dda5e78e39e7611ce71a454ad387749ca6072f1cf14c2d30571b594bb8a6a391c6c401d5cbacbab0fd9f6fe0a93fd309d69ab4d5a81016c6283eaa582036139eead92422a0405f7815b6881e3900a6e8f29995316041762cb6891f537679c62f9b39aa104e8cc8d80277b5ec009889b0c9e04e3457cde9d777868f68c456b721f37b4eb2573d592b0db7cedd0dacd2f583b72be19383dae5a8809416017b1ac44754b6f5ba96e23e606add56d96adaf185a3a92b367aec32e4a63f12bc2d3ce815f5e59a7a4ba2bc1f2f634f10f73b796e3cd63b6a2d7f52c1762da12ef874c329342d742f6a26a9908c3b4c3f9c4a2133959c5548aea99d7bdc825cdd8c28d694752025994a5554f15fee2d74ffb559bbfbf474b3a22d34bdca65c245d70b701ca2572f7435bd7eda4498bb48806e8854b2a4096ce1591497cdd97c36ea3829398207d1fd1c4c5ee371d5e703e000445bbc2bbfaf05fd1f86b575bb3695a8ad5b7f345f36d9b7e85027045b4876352c02d865a097bd246f59840e712bf69a0d769ec3f7bbece6df05eb9d3d48771cfd26b56cb7621427aac57edc37954fe1e2b975af97b513b3a07f32dfc060909b0a6b29a5867431301a2b6939250555c0b6141543546a572eb9ce123eb7eaead32493be7fb4fe569f4bd3278d9375bfc111457f7974bab89f21c67ea28ed589a9e2b30c55fb1621ecbc19709edfcf43543b95579e70b7f4b61db750aab7930c0c05273184c16bb72283d3edcd7a2f22172789054790b06df8006d290f2b4b735eb767a0384cb357fd86d445e5368c3bd613952cf6a9a7d127f88ffa43cf2808d9bc244d4dd9ba661046bb5e6d740cb32f1320ff23dbe25e016b9139f4beffd82d5cc4cc0f43c8a55a7225406ba23ce3615242dee824eb7cc362033aba924c7dae869720c29f84e46cdf36aa4811773f1e48e342b31a30fc509cd1c30f1e797e0702eb79a17660b49c165cc003a426a48996e81a31cff8e1cebc3a1abd51cb33e0430284319b9589bbf9da22b273c78817b15d4027e954d7600055a718fe2f89af55fdb2ed6dce4264bea21af1ed2d238868e8db4fd59eba2a9f5a5d87cfa07ac017e9ec9c16944fe55f3e65e4c07dad86510703fafddb40e745a0e9c13105ffce10a22a5026a339a1e27890bee7f8dab3728956ea50cf929b7804f7252e2f8372f417f184aba7b944a9f6b07d0a70bcf23c32cb9999fea3cdb13f7ffb29fc7c4407f2442f0a4f5bdb8933506e4bb50d3d8da5fd002b2af2941d639c36330041fdce37a7c5b05416d360c1f9d47389258483849fc08514c52d4d2364ad9a61402d90c8cf83a29e965a169ff588f813389d2003ab21640c0e9fde8471ba98705d82ed5962fc068088edd2b6e7599df91fd45eb2f5a2ce5c04aa7ace2d383dc74ebe04a8efd70a852e70c8d5fe775f721ca1fc73e4beb073a3c3fdd8ee078c8056cc713a4dc28548797c8e4ca43f051d79267a2d0efba10ff039dfc4aec01adcc53628d5c4c4d187d5fe7b961b7c78209cb0255c5cdda7456c50839dd617cf33154d93a63a51fad1c21ddf9f945b2f629906f7123c9e04a17bd455b5da496230f08123c96165be256631a0593117b95e3bd57ad78bc8ac49dfb1929fc439a375db190d55df413a1a5cd380898bece6887805713e40c21b036ac4c62e4e874e594e58f5cd5111ff0a644e92c5373e3cc219e98e7da61536b286b89914a37dcbf63dc2283f57b2d67b8b29f417633ebd69ce2452b1e40bf580ad93f6b11c6230eb70a668a1f3ca369119170973e8826b64f09b78cc943bdb11ef216a8cee4ab099c27a24ad0a91498185dd648d1112cc2b59b7cae14dce60827483e64979cccc5ffe786f2fa0b8cfc297135d33dc1177c508b0bf5f61ec696f3b13f1abdce85a45033480059d8aaefe372cf59be743a442845670e72ec6565797a7df3621132b97b5218013b4e1fefe5eaaa9d57c41bf302d4287794839a504c485b4c06aab44d165e2bce2444f663d02ae27e11e0f1bbef699b7e253dc916fb99e1db95df509e771f1c8c5ae70ff4fa9f5cf2666951f954aa7274a1654d3364256406c0f8bd541098752779fae2c5e9535f537992f80e52e722921f7d151c664c4d5854712297445a292c6d165e6655b911ab30341ca4cc3a6bc9fc241204a1b8898857dc606d9d219a27606aedec5134fc2ce59a167d5dbfee97e5c8a3c9f0f3100dbf1dc37f4ce634eea264c8ace081304b6b85d6ece80267aea90add4aa2f3950b32eeaec776d32f654884bea5f4aff7db2fde7636f45f264429bc83bac1a4e7074a0d65039179762fe90309949c1a52ccbffe98c5d9e3cb5260c6f12981b22bc3577de76ddade9d07d583b06c0e843a39a6572610a78d18b5d9957231b39c059094ef52cdfe31a3732a7ec70b62ef2b02090ab215ff7989107a03a2ab90d5890d76d276595a248512232aa5c7b3713e9f96a12ba005500ee0b2f1acb4b70b41b72f851c0e651b3076d097a726d7ad6a6cc4d4be1fa945280dac32e1dc012f7eaf9dc9631ea3c269f4eb30edf8810a6ea83e79d29177d93ba7b22af318c711e95c1e1b6b209f8fa7dc7c0468820d3ce840ba4513f42d63b2e2a30d6dac0dc6a808e83efff72884f15ec8e05f60ce86a029a279547bf5cb416691601584fb97cc6ac63cd6be842bbab7b118948989c3daf90a64d642bc88c63f416a33ee39e406b841d01481b972de5dd9785dd9b77e9da6cdbd21eecbd60c7e2c78c3cd097379bfcaecd29070c2e652222c685876c72e85eb74a846808c14a9be5b8cc93530fd3d94cf4ce09ffe9b79c5108f89c39322f10944789d997d2bf3965672614139b15a0f05b3068bda2a028c81b718b16847439f7e599c8361cde64989731c646db18679d4f467df54fdc352b55512e76528ca1d98a7462d4044d985dc64a98d4885371917767f11a46a11a24d85c4eb4e4c8b29446948b5f6fe5bfc22c2f1d85802eb982acf54eeeed5cd9c1ecbeea91ede218b89553047feb79e62363ff3434132d6ccdd6f0757683dd4887069c05a783d635ffcf2d942628ec0440aabcdb53f2b2a5be497a56935521b4cffdd8bdf482af2d80ba0b29daaccb6954f97e91faf2b646d068958156f379f7165150fedf0e25c05a9078b49761052dcf576e67c1d0e3d76f5a7c9bc4085943c8193a5ab52466ee4039c82095bb20f8d03951288c7e76242ba2f3bbaa24172e8bc63d74b6fafd8335dc758483e694002d4f09aba5f98f1449dc02988fba88558ef871b2bc96971f233b470bc0641247dca05aeddf2d629660d4a0a09719df76403eef805d7ff78d215ccb8998707a3b22f951f739047d7001cbfdb51965c104bdc177e171e8db9b0d3fd03690bbed1410ba069abfe3ac98c15542ad4f0bdb8678952522c2ad63cfb9659782732d68203eb7a8a3b4bfe582e775c6c4b7ed7449dd11055bd90936ae6016f543f2d3e6fd2bdb0f8bb190e478e78526f186f44e7468929f6cf0333ffe6948775288c82d5a869f440251247c5591826abdb266328af9f1dbd71678cdee6bac8e352dce19c66bf74e7baf7947ba064c39ab91c8ff2a8f5d151a093aa46441a3e930aafcb5a0b986fc3298407daa22856fb50abdd79cb8900a393ff1a528980834afcb2958283f69915e8424cf406a6abfd2fb665befc13538c16bb9f0e0f0c9ce10c83460efaee30555fce31889918f0714053255060906f353eb7a4a25e86d3da63b6079a2aa548c137fdb9c5dd37d07b05d8a00d6d121c6bd0b4081ffb38cc191ca5973bedc0d1f0729655da43a8fc4d62d0e6d268d1493b51d1e058efd2d5694d6aabeaaf8aad0cae78f7c7e7148eb009bf794d66f520b1cd71779743e88bae009e1ef46cbcb14284a289fa286ae206a4e0650d2fb0ff4bfbb18c0f6e7f3048d0fe9ac02de25682da6e0c2a172f9ac3270e6ec3f975958d2304238edf42b50e6cce35eb55e6bf68aee4193adfe90286e8f6d44c1e26bc69af076fdf67eca1f7d2764ebe2efd4bd0848ea9b03a79a7ed6ee0ab7ebfb5770eadde64ee27c325e223ed0149185fc31e64401bf261c6bc3b431f1b59c13985ca0ffffb5cc4c2e9d937cfd1b20ec8547a0b7896c8d768cb9c89732f7c1d1b656b379a1a5d0c67c279d413c6bf4cbe79b47ced34c1cf7c82f9a6b4abd948dce6e81bb81c9003dde0bd0b09a1fcfd7998738af7297d2d92792bc08a8df5549bf9c6d1eb25546eeafa56f78d26bfdfcc8f446f7e5e4563b86b7675b09e074f8a301e6003fdf07b6e369d786d4ee2ab3a45f5bc004ee5d800846eaab8e90911f4403b25aacbe9413a24bd6a0d8eec6d32ee87e2990b7a9828310027f9a054ec651259425ade5dc66c45da70b3ed58ba4bca999a0a4c18e2c9427a8b7aadd601ba62e7cb2218c7e35a230f9e5ee6e3ba76e582b9fa2d29f0a007aa6413bfb112c34263cfbffb839970f205bafe5e387a607e64395089eca959a98277d52fdeb4f5857f1937c0cc4db68d9b06222745bb2b90f96d327dc9b1c897292bfc4b0538981c2df7d068c0edc7529e1c928aa0158b44f604a4c7012e60f7b22a9c5a385fc47047acfa7619714f99a3e18a11cc3d1a80767cccf1301e3775f7b834e4ce619ff14945e553948416dd429d200cb1bd8f6a000a47ed295576b482062a1cc63e6bce402898e484e3ed88d9393d95f2b1a7dbe48bc6114691350e7c8c6d95000cfaf888c1834f4f1f8f580f15b8a11dbb0ac18af74c70f3d5adbce414e123605c1323069840e8911b5c745034170a61a5249f5673aec83e4b70e668df05c7c0b5f1f04a0d0030c6fdf0146786c250baab5d8a6255c7c4cef7288b2c4a111eff4d01d352c1f8038ab092615099c9e078f08ba28e59c52500ba0568403a8b2fe6093dc4af0825ed757d16fddaf6dcc23d08fb1a7e19129d4a5f9620a04152d21b905a91672576f2092a1651c4d9584cb70e7c964c7253f1261a2cc043dcb3f7d41de4390f3576b5f23a5633f36e7b418c0d8d26eed4a4e21b65f4f28d397b59cdbe6de19a34a234e4925a5177aa221ba29f3222461d820e1cb63cf80de186a48a33607803624ef75609bf8e28de0b3342804793e688603f4229d676e8573a2cd013478cda150fe5ec8043aeae8e4404d8f70ff2460563be295b96e63049b47c28d0f5ff78eb9570ef993743ae400d33407bd7ea4902330fec929cca6d4ba8a6155f6d731b5b4d82431ff70d5249876d097c877b7eb3563aa095f3c747873216458bdd918dd1275f927f92fa377c2f18f0c6704ac0d333599327fdedb1832d4dd2e6c9a5ce7b6751d59c03262eccb7ec7b12cb5398c6253476f390058f4928c45da4dfeb2e10dca1d2e4077cec608fd2c4070c1ae0c82f1334e3c6fcf66d583a4045744610f89c483b2239317ab2eff6576613023ed52d61c569cfb658bda100b0f38a65b302638018c27be35e217ed31df89ac320d653c1ed4327e00e0dc9ff26d9440b65ad1fa4a0ebb8a555ecc3d5d6ec01a4238b59604c00972ed8b63df0b147343db0f9401d1f45d50195226703525cfa0e85123e96e85f44bac63bdb29f661de8ccdcec1a44829aea2fe6db107bd29fa9a361a81da9be7e41e80acc12b67d7a8529f013931250f0c66a5a27cc7e82adf98f8e5376d73361050331df4d36f0cf881ecaa2d8f419b018b845e204f67fd1d57312dfd8872d73ea5afccacb078b9c704b1fdf6ce0195e007ee882d45aeecca35f8859c70e0672957153367b09b63e3b7b1f4b6885e5f98df3782494d98080dc39313ad12c99c9e4e4f82681b24a1c6914988d580280bc2f2bcb631a7c3632d1301c4dae8ff0665590072f72396180bba141bc41917b0c74415a5a320003809ce6265bfc2ae9824c3b67ee4dfa5d205e40aa1b414de85ed8d572ff515e8869b7014dc701ec7fa1813d523b7ea69b5c685c2513cd9965bd630b150fc7f644af222f0db75c67d1b17b686a9c7c454297579ade7edee713b1ec44605e9d90c1aee864dc3bf1eb5107cd941220674cf7f9ab9b3ba69c6ffed087b6b8efc6b765c82f82bd5643687f6be81b0975d09c2631e8cfc1b8a013530e5f185752242cb5f8014ef836a4379902c51e92a612c22b3cb49e4d1986d3f56f29730088a8674d138cf620de87485194a43214f93700d9816e3257dfe58f26dfd807a85fa4efcf74b5ff9acbd9d10323a845a70e37c3813bc7ee086bb533b7a6d63ff1a7011fa6c61889d6218ae01113412cb079c757c5d58bceac3a8abe03938f260de734737b2cb1d6d2907887cf66e9c9cd9e1d2eaecf55a6c82c8f09b60a40baa4fbf6a24e647c7aaa9dbc7241bc2d1eadf7c92b269095fb1ebcb5f95293a48c76f2e725c16b0317864d332bf00305b6918c1727ee8f0d5b30d8c3562f6143cd50030a32c02d46c6eec62e649db4c27ad8c945b2e46683b5ecdbc41b4f493c486acfc3859748855302b534dda34c3cb0e1bac188dde16a99300933e20605b894f7f88921746aaede51e1adc0b69c77ed4a2e98fe6964c5c1dfed664e75aaefedbc1c566dfdba7955f807d980fcf4d1368347c586e0eec14f2345a01b673db777273d4e3443bfd14d41e53b685b16a4c2ab6d1d31a8145b15427e40198cf3b6657a71478913ab9e0687802f00043bc1c526608f14ed002ac954fb60c3412860c1f4d5437c6f90a9604ed63491ff5eb2c42e2ddf7c097023b274f5bd6bb73931b64a77c868bdd91adc953fc27eb2e6e76c9e4184a30eae9e61ab7203a207c74f51bbd5c95d2e609888190d10863f2186558805963e7c8f2c61b1607521e5dc7948d5fe17fe2d766a58a725ada06d78d55c34bad4fa3dcfd2814b52161c2729d8ccb4525d3afbf0f96467eeffa5411cf0e9f4adf728bd94c4741b693d9ed90a885b8e99fcc0d087fa0b9e569ecdeca2217c160cfe8326e40e9660a1315233efd12b76d867143b6d79a0ed0da1acf0caeebb583fe279383c2d8e66ba9b22da3070ba6c97a763042c5a6e2a0e11fad177bb594180b9965c51e79602bb7e06c53b2e5916050213a9391f8276587f1e7f0ccd2e7b65f6ca9d441e742e5957d5ab84af37e062f5e9a34cee9d26f75efe9812c56e2c24859eec0af2b2ce45f76d6cae5a1101c0f36500db21be1425314c89922e08906fbedf44ccbb4d29bf140bd47524abe43a56beda9cdf3ff9510cd2af9376ba77e284f1a131dd7b2f5468eb584d11f25f00e008408179a4f57679e84f4ec5e8ed4058a1ceb063cb58ba1ce295e8b8aac1add9ff81f74f789e915c892eb3df5b8f0504d272d386931037d7d0a00638adb563973bcd0904320b575b3e145b6a996eaabccdc178b8708e153ed48360098bdf96427ee17aac6c4e1f0585d0fba65f4715a87480b568449b7549a6a5bdac10744bd94a24d4e67d74b003382c8e4ea182eb036c92152b55eda36af022f3f8d310dadffebcf112b776251d688ffd26ef1d52bac261655c194077f1f311de658ed39cf974fb2e0947a841fac3f7bfdbf05a2d29b0d3e72d6eab8ccdda20913d26232a43639038e3f1744e9f1325241a4399089db281ab2479ee182c05e9b45c258de9c7923ef4b8bfda018eab2989486376ffae3029adfcbc3d1d37564a91adb3f9be2cfd40d3939c725eafd10703bd9867f243d864a8d3683b0717c084783b45c1e75cfcc2718cbd0934e10e223444665b612f9cf646a3b53fa51fabaccaf4f1d5f018bee65c0dd2c50810d3fcd737aa90bcccab4f68e3de3feaabd12499d4f5ef659df430c346df2f80b9f7b7c689eb3fbdf62acd04a8ffa492f60ec0baa137f7444b548f4ad21b9fef7ef5b9fa24718a59cbe3d298242cb1662e9b3b6538c4bff7493f4b91af7626d40534eb0515907472653d58a563e599a824e51ff0bec06a44885cd2767035c15d0d64511c2ada92856e9b52fedff7c429f11aafafb8d2ef279da8fb28cde934a105581517f05c863f147163956f7bd2a5afbc21941b0f77eeee8cc88d70d14054513b6ea5854818f6bf3e47148547a14528a5604553a49fdc17d546da0e17d0cb5e42bdea552d5cc6ce000232774a3b355edc31547b171496a4cd3bffd4a5b7c239f66945c4718e64508a2d61bce0ff2b5af63b7acbd88713fe59ef0f38d64fd882ed115b8f38c7eda9f92b3a6fd3f13d7662f808e5541464b1677f61f3939debbb7c13bff55f7e3ef5d5df859c03d95a20458ea3104f58809f2fad953b287a3dc056e1dca7d8ac915e3aa6608a8fc9c05b5b652d9e59d8c0f9b7d4c3bb48f0ab174bf69916992e0d29318b7b3aed1886f44cdd5b933939e00392cfd558998ea0bbdd133b40ef3cddf7dc0c02946b71b80fe835fa67ff7e532d732c5368f54b0f81a383d9bd8ffcad35736c5d4484409d24a91adf18289c6d0df94ad0e0d93d35853c0533672974671ee8962a8c600b7680fd007b9660b14da1edd427fd30f34bd9ff97cb2bb37e7f04fe1d65b347a109de014cac1e0ac8808de2ac84831948db41761979e738ec16794f0318314091f5146b43b369abc93bedbe38433999300b17478625aa5595d31243a8c930ab60c694e74e8171a4ebb042e75b20c517dbbe362da6d4bc7363ca8e2d5ec1778f5de4000e0a2233f87decf183ee9f07a1485189aa634213107b12ec17f69633e8c51a5f5664e4a920caab833851d2d409e273484b359c4098ad0580923254c4b9b03ee2d8e3156549c801633957c1fe24a6d27d41660250fd0e34ffa50865ad12f5eaa8a486248e4bb355f7dae237b9aa5ef3e26193f250a53f4a1158763c0134cbefd950e35c8b677751a5fb7af8e201d7251a272be6db373c3f1db582b230e37088044158f3bbdf71d7980df787a5cf18a97f5070c9d3eda038be42b7dc99395d745afb50f0f9f93dcc4b4d76e3d8a90304c0f196f7ad130e165a8993c301f5df4034d0da48cc9c543f2755a9cd8fcebb8bbb7897d1fbeb7db43060ad7a552d564a933a8e69981424695ba8fe5ac76c7b94c77e12493112a574fae8f9f506d5731479ec4902dece3ddd5a8020defe689c4d07aa4d02a473db785d9e0f2d28e62643136688dbc20ccc10071316806daa0393c80880b4017ef633dc0b6614fcd7dafaddc9824a470633300632ba1b7e0b5ae2f2c2237d3545661dea2b36b028f4f4185c5907e57bd5420f4b18696a3eae7f9b32fd0e7bdf1e0fc3b331f9271cabc5f850a53acc7d0b21b87167208836bb714efa28717c650eddbb9a9c5152553dc4f5cf5331d0c0b11a11633fa1b62613af8147c63ba2efb966d6ae4aecc1dfe92fe806f0bae0d593f199b011dc005f32289da65efe261440882a2d126357595cb19c91e9819b53446f7d2169d2d01fc3d5187fd3c3dc8c206fc714cee52470be04c162e6efb889c4c51fabacab4c98f47a1104dfbce2648dee33ac7357ff6fabd1b7a283c0376e5f6205420512bd20782c91d9becd22f8b7276074685e965e7559400b5cce252123412b9669e0cd6dc37e3ea6a2a9a659b881f2b7063aabfef0ac49f066afa7d1018c2b5c4263fb239dc0118ed479743ac1f0b04c6749c62bae25dee35e5e52c12dab84b43b5285abc9583e60308e86795db47912530cd45dc57c8f090f0a56ca9a5aa94d39aff74eb8e46ce888674453c312cc9596bc272acd1431b38c270d19f3afe88a3869ccade0b6d52ebefae267be21249378084c5a3002a294cf8414346741435a202e63db90097bb6d058876b05412bf4de02abd112652e8b33e0475806456cb9c8b2321e1a256aba8ca6e937d4b9ab9ec9e07547d96cea4822f8872c95db6a5b4a1711f674e4e5c55b7dbdcc625545e23e4115a44b29ae84be350cafb44437267aab3a116febe200ad2fd19f4748683addd94d82e78ed6588a8c7f06a68f9cce50dcae06e492776ffefa08106ce1c060ba29fd327e638e1ce87ec7b9a20cb213e020be3ecf322d31312df2c748a65e35e0bf7d5513fa185089016cef8c1929ed5fea01f90658cd68ef38d66b9db7b1e906a6298f21ee2c00e19c2aa61db0ac33c1f476d850e2f47f02a26c15534392ab887db105f5ac7bb2c206c798c7e216b58bcfa18502e1c162a6a74a97be5dc780eedd3c2d7980f9628803aa80a7b207c286809a8f6331b9c9d6179dd6ded2aab99852a687eae3f9f937db945f5821799b6b28717da9992f9a15abdaa7abf10d6885b4ff08d9e13e022a4570b463bac10c9880a254a9d8c1beda01f7a008ba129ff67824a1c50c01279355aa6e70b98b7df30d78e5190660e3883e8346c01857737c97c936d5a56da3cb586fa2ccce962307cf0509e7d65ec1970fec563272f6133850ec97bc5d08012688eed668bd7966616aeb45f8c2f40c0894c9ced93da52802217d0e81a75738661dbb53a0838001445696dc54742d87e70066320d7a04a5b6e378a65ca3f7259614487e3a2750d32df16715a1b310ef7c66958c49cc5bc57c2c5f95e15cf6d19c73a0ed47c25f811f3a2effecd01595bdbb580e015e325836fff6bdca765abc93c40315717b7e7be08e4260f242206b900d27dfea7928088399ac03a1285e738706e5b0e7da2f2e2d8b5d98860fccc7bd56943ba5746697cdd3ea3f5623e0a7177a73cf4d9defc70ab844589d06450b5bb748c80a24951a7f1d796b8329c9ee5276ba911143be4bb2a760d18655183f873027905fd1e01aa90bbe1b9775ef25b9d1a4f288ce6effb0bbb4effe6102b0484a65145ee7b634b31dded182746a42961236d47963b0501ce0eb6338b9d76f83de9b2c4e03cbc5dd1feb383713f9bb21a6add5c22224cbbc8d300458ddd5a7905c9bfa7805e9f92e39534e1a0fc4459839798665524fb56459fe598322e9cba026bba1607df98cfb980ab07e43313b4c9ee1323f823bf7aa484ccfda8724cd5aaa28fa82f186a8c3c2fbc2d96b7613aa6d7e56cd99c4ceb255572ae0f4577e3b18d3661c59eda466317a009217ef689b0d680ca0ea8ccbce03d252ae4523da4d8a45cab4909978708dc24638699097adb09bf9e6e576732b2946cfdde7e24930af2c3eb92079001c54a1b795c40e42ec7c34d13642ad12b58ffcfd1b4412908ff6805258d92a56908e41fccf8ba6cb4d5bf1cdcd33a88c70a87b4e4e1ce0ba021ce08febc20feabab0c6ee1bca42dce4766b18401d6cf6d08771ccaefe6fca6adcf8cc81e93a45744381d13f5d215f0da3deb8c53f0e4eff9cde017c130bad31ff3492067b276e7a29e0072cb48cfda00279380e27c381021dacecab811bbb00edb5b51b8e4d8ece64db10010347f02a56e6666e76242e764c5e92436ed27f8366cec8e2ea61eb086ca7a5abfb54efe48f79e9242fe4df3350a9ac9071ce2a64fc84e9e1c6e3ec5a4b6732bb69c1751bb1642fc03a6a8d4f95da747eebc97a7769fae04a27ec4ef9fbbfa9d4cafd7fe9173861242adebcf12e8c4297a7235dd19f0251fcfb0150da7ed17b99450cd3ab11039e12b7d18553e4aea92f462333001c23000ca5fff34744d02f4347c341e8c8f21b0228f064d39fcb247fec4cdfd9993c65bde0f6270aa8867a75359f5be263421ea14c63f0e4cf7448e32f0bcf24a4f9ece128f0141ab28b0175b88f039598f23067380787144a9d08ed84de018a830db9d22da1f84b48a9f206faecbba51e0ee950fee96f9639629bc20f5336e8afe2eb9ded6a5656a75d00a7ff3cceebfc7851d76603afd6b2be50b7f847eec16fbfc607496cc64bf0e1c5dd083d4d9dbc688432110822364b6390d2f11fc86e2d276d351dcbf3736d7dfc65d947274a402a27185674f11d00f656a4ed1a2647bf81b8de4f63685fa7d04ac28001d6dae7d622d6ba5c2139ff4cce04f7f671691b4912a03481c6519993e3968b838e6c2e7406be44ba34cfe6b7235d66427f76e9a50a1aa57112a7f38269ce68d63851d47f874ca2d2f5505e45936112d58620d141046d3180f5f0822bd45b8d6e3cccd5125f6f81f3cfc6e90a0c1ce0a5bb3c55b48c6324079b61de73726c0e270271f3b8fdcffc3d42f6b8534ef20c6ce49a595ba384945b419d392eeef3900635411b8b6c0163fdbc2c7a26d42023c9b2b30e1996e9702f57ad4033db5f11772a2d7a8a41cd0a9fd481606c902a176f85c81bf02a2f3af5cf1d826b840daf6f7f0a2b1d2eb7ab85be51f5f8c953286d9a33bac9092f9ef0daf1c572a03b79894fd2d3f9853b91c1e289139dd2bd60d4a82965e12d23dd7c2b8890cbaee48f71bc137d8562e764d029d64db68bd212077f1bc8d16c1471e4247e50bb5b6f0e6bac38ad44b642a54115f3ad89622cea0705b62b1dba00db7ce5c85199f535d1ed60ddabf8883d5d118cbb6c1ec121a5cdf2dc98d6e1e045f546c0393a10f0c035ecedf782ae93b453ebdf1642e656705bb34cd8cd5ef669b9d7a252917e1ca9a1782c8c2cafc64b2517a001b02bf361bedb3210d8a4103871138af694cf4e0e3179cedea70009861d15d3e01dbda1970e7536c4f82198a71b11da5fcf96eb937033fb5a95fafe773148506ee7b783df812db6510f3dfd64082b75d5d1b3bcb5bd0604c9f9b408c0cd69917b508edf9ca67643dfd22e3da183812c25a9930fcd14ba9268dd6a841121a4179fa19bc228d32956b30d8d904e20f25b7f1ee4c03230120c55f9e3826d10324f1791a68f94a1ed525edfc4dac968a7b0c478e5eefeb604dc1dd04654271d386879770d3983498733e73a3e6e9efcf2048461a0d7d95d39c94b5605a44f30212f0695c1489d3ef429bdc39b458a0158d7d607190d2120165b673d78f55a18bbca2081562f01ece4af6634cf9f28b35f6a5a5b2fb4c6d21f32e465cabc412074ddee4f482103806843faa86c2a7b9813ae55357d717a7872c5bbd8406c6cc7c060299ffb5f0b138ae130a584b3dd14a7cacaee49f393d769e5abaf5e32ebf4594b7c93a59ecc5a313d2e5008aa4b5fabd0067f17b05c2e"
        )
        val state3 = ChannelStateWithCommitments.from(TestConstants.Bob.nodeParams.nodePrivateKey, EncryptedChannelData(normalWithHtlcs))
        assertIs<Normal>(state3)
        assertEquals(state3.commitments.fundingTxId, fundingTx.txid)
        assertEquals(state3.commitments.channelFeatures, ChannelFeatures(setOf(Feature.StaticRemoteKey, Feature.AnchorOutputs)))
    }
}